@{
	ViewData["Title"] = "母嬰商品團購";
}
<!DOCTYPE html>
<html>
<head>
	<title>母嬰商品團購</title>

</head>
<body>
	<div id="app" class="container">
		<!-- breadcrumb start -->
		<div class="px-3 py-2 mb-2">
			<nav aria-label="breadcrumb">
				<ol class="breadcrumb mb-0 bg-transparent p-2 text-dark bg-opacity-10">
					<li class="breadcrumb-item"><a class="text-decoration-none" href="https://localhost:7231/">首頁</a></li>
					<li class="breadcrumb-item active" aria-current="page">團購</li>
				</ol>
			</nav>
			<div class="row" style="width:50%;margin-left:auto;margin-right:0">
				<label class="col-md-4 form-label">篩選關鍵字:</label>
				<input type="text" class="col-md-8 form-control" placeholder="請輸入篩選關鍵字" v-model="filter" @@keyup="filterProducts" />
			</div>
		</div>
		<!-- breadcrumb end -->


        <div class="container">
            <div class="row">
                <!-- 左側導覽 start -->
                <div class="col-3">
                    <div class="accordion" id="categoryAccordion">
                        <!-- 媽咪用品 -->
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingOne">
                                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                                    媽咪用品
                                </button>
                            </h2>
                            <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne" data-bs-parent="#categoryAccordion">
                                <div class="accordion-body">
                                    <ul class="list-unstyled">
                                        <li><a href="#" @@click.prevent="filterByCategory('孕婦裝')">孕婦裝</a></li>
                                        <li><a href="#" @@click.prevent="filterByCategory('托腹帶/束腹帶')">托腹帶/束腹帶</a></li>
                                        <li><a href="#" @@click.prevent="filterByCategory('孕哺內衣/內褲')">孕哺內衣/內褲</a></li>
                                        <li><a href="#" @@click.prevent="filterByCategory('產後護理')">產後護理</a></li>
                                        <li><a href="#" @@click.prevent="filterByCategory('哺乳用品')">哺乳用品</a></li>
                                        <li><a href="#" @@click.prevent="filterByCategory('媽媽包')">媽媽包</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <!-- 寶寶用品 -->
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingTwo">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                                    寶寶用品
                                </button>
                            </h2>
                            <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#categoryAccordion">
                                <div class="accordion-body">
                                    <ul class="list-unstyled">
                                        <li><a href="#" v-on:click.prevent="filterByCategory('尿布')">尿布</a></li>
                                        <li><a href="#" @@click.prevent="filterByCategory('奶瓶/奶嘴')">奶瓶/奶嘴</a></li>
                                        <li><a href="#" @@click.prevent="filterByCategory('濕紙巾')">濕紙巾</a></li>
                                        <li><a href="#" @@click.prevent="filterByCategory('嬰兒車')">嬰兒車</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <!-- 玩具 -->
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingThree">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                                    玩具
                                </button>
                            </h2>
                            <div id="collapseThree" class="accordion-collapse collapse" aria-labelledby="headingThree" data-bs-parent="#categoryAccordion">
                                <div class="accordion-body">
                                    <ul class="list-unstyled">
                                        <li><a href="#" @@click.prevent="filterByCategory('益智玩具')">益智玩具</a></li>
                                        <li><a href="#" @@click.prevent="filterByCategory('毛絨玩具')">毛絨玩具</a></li>
                                        <li><a href="#" @@click.prevent="filterByCategory('積木')">積木</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <!-- 嬰兒服飾 -->
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingFour">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFour" aria-expanded="false" aria-controls="collapseFour">
                                    嬰兒服飾
                                </button>
                            </h2>
                            <div id="collapseFour" class="accordion-collapse collapse" aria-labelledby="headingFour" data-bs-parent="#categoryAccordion">
                                <div class="accordion-body">
                                    <ul class="list-unstyled">
                                        <li><a href="#" @@click.prevent="filterByCategory('衣物')">衣物</a></li>
                                        <li><a href="#" @@click.prevent="filterByCategory('外套')">外套</a></li>
                                        <li><a href="#" @@click.prevent="filterByCategory('鞋襪')">鞋襪</a></li>
                                        <li><a href="#" @@click.prevent="filterByCategory('紗布巾/浴巾/口水巾')">紗布巾/浴巾/口水巾</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <!-- 奶粉和食品 -->
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingFive">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFive" aria-expanded="false" aria-controls="collapseFive">
                                    奶粉和食品
                                </button>
                            </h2>
                            <div id="collapseFive" class="accordion-collapse collapse" aria-labelledby="headingFive" data-bs-parent="#categoryAccordion">
                                <div class="accordion-body">
                                    <ul class="list-unstyled">
                                        <li><a href="#" @@click.prevent="filterByCategory('奶粉')">奶粉</a></li>
                                        <li><a href="#" @@click.prevent="filterByCategory('嬰兒輔食')">嬰兒輔食</a></li>
                                        <li><a href="#" @@click.prevent="filterByCategory('零食')">零食</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <!-- 洗護用品 -->
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingSix">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSix" aria-expanded="false" aria-controls="collapseSix">
                                    洗護用品
                                </button>
                            </h2>
                            <div id="collapseSix" class="accordion-collapse collapse" aria-labelledby="headingSix" data-bs-parent="#categoryAccordion">
                                <div class="accordion-body">
                                    <ul class="list-unstyled">
                                        <li><a href="#" @@click.prevent="filterByCategory('洗髮露')">洗髮露</a></li>
                                        <li><a href="#" @@click.prevent="filterByCategory('沐浴露')">沐浴露</a></li>
                                        <li><a href="#" @@click.prevent="filterByCategory('護膚品')">護膚品</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <!-- 可以添加更多分類 -->
                    </div>
                </div>
                <!-- 左側導覽 end -->
                <!-- 主內容區域 -->
                <div class="col-9">
                    <div class="row">
                        <div class="col-4 mb-2" v-for="item in groupBuyings" :key="item.id">
                            <div class="card">
                                <img :src="getPhotoUrl(item.photoUrl)" class="card-img-top" :alt="item.productName" style="height: 180px;">
                                <div class="card-body">
                                    <h5 class="card-title">{{item.productName}}</h5>
                                    <p class="card-text">{{item.productDescription}}</p>
                                    <!-- 進度條 -->
                                    <div class="progress mb-2" v-if="item.targetCount > 0" style="position: relative; height: 30px;">
                                        <div class="progress-bar"
                                             role="progressbar"
                                             :style="{ width: `${item.progress}%`, backgroundColor: '#4caf50', transition: 'width 0.6s ease' }"
                                             :aria-valuenow="item.progress"
                                             aria-valuemin="0"
                                             aria-valuemax="100">
                                            <span class="progress-label" style="position: absolute; width: 100%; text-align: center; color: white; font-weight: bold;">
                                                {{ Math.min(100, Math.round(item.progress)) }}%
                                            </span>
                                        </div>
                                    </div>
                                    <div v-else>
                                        <p>尚無進度</p>
                                    </div>

                                    <button class="btn btn-outline-warning" @@click="showDetails(item.id)">查看詳情</button>

                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 商品詳情模態框 -->
                    <div class="modal fade" data-bs-backdrop="static" id="productDetailsModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="exampleModalLabel">{{ productDetails.productName }}</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <img :src="getPhotoUrl(productDetails.photoUrl)" class="img-fluid" />
                                    <p>{{ productDetails.productDescription }}</p>

                                    <p>成團進度：{{ productDetails.joinQuantity }}/{{ productDetails.targetCount }}</p>
                                    <p>開團日期：{{ productDetails.modifiedTimeView }}</p>
                                    <p>截止日期：{{ productDetails.deadTime }}</p>

                                </div>



                                <div class="modal-footer">
                                    <button type="submit" class="btn btn-primary" v-on:click="checkForm">參加</button>
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">關閉</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>




		

	</div>



	<script>
		var vueApp = {
			data() {
				return {
					groupBuyings: [],
					filter: "",
					productDetails: {}
				};
			},
			created() {
				this.fetchGroupBuyings();
			},
			methods: {
				fetchGroupBuyings() {
					axios.get('https://localhost:7292/api/GroupBuying')
						.then(response => {
							this.groupBuyings = response.data.filter(item => item.display);
							progress: item.progress ?? 0 // 確保 progress 屬性存在
						})
						.catch(error => {
							console.error("Error fetching data:", error);
						});
				},
				getPhotoUrl(photoUrl) {
					return photoUrl != null ? `https://localhost:7000/uploads/${photoUrl}` : 'https://localhost:7000/img/noImage.jpg';
				},
				filterProducts() {
					let _this = this;
					var request = {};
					request.id = isNaN(Number(_this.filter)) ? -1 : Number(_this.filter);
					request.productName = request.productDescription = _this.filter;
					axios.post('https://localhost:7292/api/GroupBuying/Filter', request)
						.then(response => {
							_this.groupBuyings = response.data;
							progress: item.progress ?? 0
						})
						.catch(err => {
							console.error("Error filtering data:", err);
						});
                },
                filterByCategory(x) {
                    let _this = this;
                    var request = {};
                    request.id = isNaN(Number(_this.filter)) ? -1 : Number(_this.filter);
                     request.productName =request.productType = request.productDescription = x;
                    axios.post('https://localhost:7292/api/GroupBuying/Filter', request)
                        .then(response => {
                            _this.groupBuyings = response.data;
                            progress: item.progress ?? 0
                        })
                        .catch(err => {
                            console.error("Error filtering data:", err);
                        });
                },
				showDetails(id) {
					axios.get(`https://localhost:7292/api/GroupBuying/Detail/${id}`)
						.then(response => {
							this.productDetails = response.data;
							$('#productDetailsModal').modal('show');
						})
						.catch(error => {
							console.error("Error fetching product details:", error);
						});
				}
			}
		}
						 
		var app = Vue.createApp(vueApp).mount('#app')


	</script>
</body>
</html>
