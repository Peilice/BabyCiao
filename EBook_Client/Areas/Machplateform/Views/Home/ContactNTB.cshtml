<!DOCTYPE html>
<html>
<head>
    <title>邀約委託</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>
<body>
    <div id="app">
        <form v-on:submit.prevent="submitForm" class="needs-validation" novalidate>
            <!-- Form fields -->
            <div class="form-group">
                <label for="professionalPortrait">個人照:</label>
                <input type="file" v-on:change="handleFileUpload" multiple v-model="form.professionalPortrait" id="professionalPortrait" class="form-control" required />
                <div class="invalid-feedback">請放上個人照片</div>
            </div>
            <div class="form-group">
                <label for="nannyAccount">保母帳號:</label>
                <input v-model="form.nannyAccountUserAccount" id="nannyAccount" class="form-control" required />
                <div class="invalid-feedback">此欄位必填!</div>
            </div>
            <div class="form-group">
                <label for="nickname">暱稱:</label>
                <input v-model="form.nickname" id="nickname" class="form-control" />
            </div>
            <div class="form-group">
                <label for="city" class="form-label">縣市</label>
                <select v-model="form.city" class="form-select" required>
                    <option selected disabled value="">請選擇</option>
                    <option value="基隆市">基隆市</option>
                    <option value="臺北市">臺北市</option>
                    <option value="新北市">新北市</option>
                    <option value="桃園市">桃園市</option>
                    <option value="新竹縣">新竹縣</option>
                    <option value="新竹市">新竹市</option>
                    <option value="宜蘭縣">宜蘭縣</option>
                    <option value="臺中市">臺中市</option>
                    <option value="苗栗縣">苗栗縣</option>
                    <option value="彰化縣">彰化縣</option>
                    <option value="南投縣">南投縣</option>
                    <option value="雲林縣">雲林縣</option>
                    <option value="嘉義縣">嘉義縣</option>
                    <option value="嘉義市">嘉義市</option>
                    <option value="臺南市">臺南市</option>
                    <option value="高雄市">高雄市</option>
                    <option value="屏東縣">屏東縣</option>
                    <option value="花蓮縣">花蓮縣</option>
                    <option value="臺東縣">臺東縣</option>
                    <option value="澎湖縣">澎湖縣</option>
                    <option value="金門縣">金門縣</option>
                </select>
                <div class="invalid-feedback">此欄位必填!</div>
            </div>
            <div class="form-group">
                <label for="district">區域:</label>
                <input v-model="form.district" id="district" class="form-control" required />
                <div class="invalid-feedback">此欄位必填!</div>
            </div>
            <div class="form-group">
                <label for="introduction">介紹:</label>
                <textarea v-model="form.introduction" id="introduction" class="form-control"></textarea>
            </div>
            <div class="form-group">
                <label for="serviceType" class="form-label">服務方式</label>
                <div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" v-model="form.serviceType" value="到宅托育">
                        <label class="form-check-label">到宅托育</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" v-model="form.serviceType" value="居家托育">
                        <label class="form-check-label">居家托育</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" v-model="form.serviceType" value="其他">
                        <label class="form-check-label">其他</label>
                        <input type="text" v-model="form.serviceType" class="form-control" placeholder="請填寫其他服務方式" v-if="form.serviceType" />
                    </div>
                </div>
                <div class="invalid-feedback">此欄位必填!</div>
            </div>
            <div class="form-group">
                <label for="typeOfDaycare" class="form-label">托育時段</label>
                <div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" v-model="form.typeOfDaycare" value="半日托育">
                        <label class="form-check-label">半日托育</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" v-model="form.typeOfDaycare" value="半日托育(平日)">
                        <label class="form-check-label">半日托育(平日)</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" v-model="form.typeOfDaycare" value="全日托育">
                        <label class="form-check-label">全日托育</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" v-model="form.typeOfDaycare" value="臨時托育(平日)">
                        <label class="form-check-label">臨時托育(平日)</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" v-model="form.typeOfDaycare" value="臨時托育(假日)">
                        <label class="form-check-label">臨時托育(假日)</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" v-model="form.typeOfDaycare" value="其他">
                        <label class="form-check-label">其他</label>
                        <input type="text" v-model="form.typeOfDaycare" class="form-control" placeholder="請填寫其他托育時段" v-if="form.typeOfDaycare" />
                    </div>
                </div>
                <div class="invalid-feedback">此欄位必填!</div>
            </div>
            <div class="form-group">
                <label for="serviceItems">服務項目:</label>
                <div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" v-model="form.serviceItems" value="料理服務">
                        <label class="form-check-label">料理服務</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" v-model="form.serviceItems" value="接送服務">
                        <label class="form-check-label">接送服務</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" v-model="form.serviceItems" value="家教服務">
                        <label class="form-check-label">家教服務</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" v-model="form.serviceItems" value="其他">
                        <label class="form-check-label">其他</label>
                        <input type="text" v-model="form.serviceItems" class="form-control" placeholder="請填寫其他服務項目" v-if="form.serviceItems" />
                    </div>
                </div>
                <div class="invalid-feedback">此欄位必填!</div>
            </div>
            <div class="form-group">
                <label for="quasiPublicChildcare">可公托:</label>
                <input type="checkbox" v-model="form.quasiPublicChildcare" id="quasiPublicChildcare" />
            </div>
            <div class="form-group">
                <label for="childcareAvailableUnder2">可收托2歲以下孩童數:</label>
                <select v-model="form.childcareAvailableUnder2" id="childcareAvailableUnder2" class="form-control" required>
                    <option value="1">一位</option>
                    <option value="2">二位</option>
                    <option value="3">三位</option>
                    <option value="4">四位</option>
                </select>
                <div class="invalid-feedback">此欄位必填!</div>
            </div>
            <div class="form-group">
                <label for="childcareAvailableOver2">可收托2歲以上孩童數:</label>
                <select v-model="form.childcareAvailableOver2" id="childcareAvailableOver2" class="form-control" required>
                    <option value="1">一位</option>
                    <option value="2">二位</option>
                    <option value="3">三位</option>
                    <option value="4">四位</option>
                </select>
                <div class="invalid-feedback">此欄位必填!</div>
            </div>
            <div class="form-group">
                <label for="language">語言:</label>
                <div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" v-model="form.language" value="中文">
                        <label class="form-check-label">中文</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" v-model="form.language" value="英文">
                        <label class="form-check-label">英文</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" v-model="form.language" value="越南語">
                        <label class="form-check-label">越南語</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" v-model="form.language" value="印尼語">
                        <label class="form-check-label">印尼語</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" v-model="form.language" value="其他">
                        <label class="form-check-label">其他</label>
                        <input type="text" v-model="form.language" class="form-control" placeholder="請填寫其他語言" v-if="form.language" />
                    </div>
                </div>
                <div class="invalid-feedback">請填寫語言.</div>
            </div>
            <div class="form-group">
                <label for="serviceCenter">服務中心:</label>
                <input v-model="form.serviceCenter" id="serviceCenter" class="form-control" required />
                <div class="invalid-feedback">請填寫此欄位</div>
            </div>
            <button type="submit" class="btn btn-primary">送出</button>
        </form>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/vue@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
        new Vue({
            el: '#app',
            data() {
                return {
                    form: {
                        nannyAccountUserAccount: '',
                        nickname: '',
                        city: '',
                        district: '',
                        introduction: '',
                        serviceType: [],
                        serviceTypeOther: false,
                        serviceTypeOther: '',
                        typeOfDaycare: [],
                        typeOfDaycare: false,
                        typeOfDaycare: '',
                        serviceItems: [],
                        serviceItemsOther: false,
                        serviceItemsOther: '',
                        quasiPublicChildcare: false,
                        childcareAvailableUnder2: 1,
                        childcareAvailableOver2: 1,
                        language: [],
                        language: '',
                        serviceCenter: '',
                        professionalPortrait: [],
                    },
                };
            },
            methods: {
                handleFileUpload(event) {
                    this.form.professionalPortrait = Array.from(event.target.files);
                },
                async submitForm() {
                    if (!this.validateForm()) return;

                    const formData = new FormData();
                    for (const key in this.form) {
                        if (Array.isArray(this.form[key])) {
                            this.form[key].forEach((value, index) => {
                                formData.append(`${key}[${index}]`, value);
                            });
                        } else {
                            formData.append(key, this.form[key]);
                        }
                    }
                    this.form.professionalPortrait.forEach((photo, index) => {
                        formData.append(`professionalPortrait[${index}]`, photo);
                    });

                    try {
                        const response = await fetch('https://localhost:7292/api/NannyResumes/SubmitResume', {
                            method: 'POST',
                            body: formData
                        });

                        if (response.ok) {
                            Swal.fire({
                                icon: 'susse',
                                title: '履歷遞交成功!',
                            });
                            this.notifyRecipient(this.form.nannyAccountUserAccount);
                        } else {
                            Swal.fire({
                                icon: 'error',
                                title: '資訊錯誤',
                                text: '請檢查你的履歷是否完善，稍後提交。'
                            });
                        }
                    } catch (error) {
                        Swal.fire({
                            icon: 'error',
                            title: '資訊錯誤',
                            text: '請檢查你的履歷是否完善，稍後提交。'
                        });
                        console.error('Error:', error);
                    }
                },
                async fetchNannyAccount() {
                    try {
                        const response = await axios.get('https://localhost:7292/api/NannyResumes/Contact');
                        this.form.nannyAccountUserAccount = response.data;
                    } catch (error) {
                        console.error('Error fetching nanny account:', error);
                        Swal.fire({
                            icon: 'error',
                            title: 'Error fetching data',
                            text: 'There was an error fetching the nanny account data.'
                        });
                    }
                },
                validateForm() {
                    const form = this.$el.querySelector('需要驗證');
                    const isValid = form.checkValidity();
                    form.classList.add('驗證成功');
                    return isValid;
                }
            },
            mounted() {
                this.fetchNannyAccount();
            }
        });
    </script>
</body>
</html>
